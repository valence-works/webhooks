# Implementation Plan: Baseline Webhook Broadcasting Behavior

**Branch**: `001-initial-src-spec` | **Date**: 2026-03-01 | **Spec**: `/specs/001-initial-src-spec/spec.md`
**Input**: Feature specification from `/specs/001-initial-src-spec/spec.md`

## Summary

Implement a contract-driven refinement of the existing webhook core so broadcaster orchestration, middleware boundaries, dispatcher coordination, retry semantics, and observability are explicit and testable. The implementation keeps the current .NET library architecture, introduces/aligns extension contracts (`IWebhookDispatcher`, middleware contracts, selector/comparator strategies), enforces startup validation for invalid configurations, and preserves backward compatibility by defaulting to current HTTP dispatcher behavior while enabling host overrides.

## Technical Context

**Language/Version**: C# with multi-targeted .NET (`net6.0`, `net7.0`, `net8.0`, `net9.0`, `net10.0`)  
**Primary Dependencies**: `Microsoft.Extensions.Hosting.Abstractions`, `Microsoft.Extensions.Http`, `Microsoft.Extensions.Http.Polly`, `Microsoft.Extensions.Logging`, `Polly`/`Polly.Extensions.Http`  
**Storage**: In-memory runtime configuration and queues (no persistent store required for baseline)  
**Testing**: `dotnet test` (unit/integration/conformance coverage in solution test projects)  
**Target Platform**: Cross-platform .NET host applications (Linux/macOS/Windows)  
**Project Type**: Reusable .NET library  
**Performance Goals**: Deterministic delivery behavior across sequential/concurrent/queued modes with no cross-sink blocking on single-sink failure  
**Constraints**: Preserve backward-compatible defaults, avoid transport-specific orchestration coupling, fail startup on invalid configuration  
**Scale/Scope**: Webhook broadcast and delivery orchestration in `src/Webhooks.Core` with shared models in `src/WebhooksCore.Shared`

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

- Spec-first gate: `spec.md` includes clarified requirements, edge cases, and measurable outcomes.
- Contract boundary gate: ownership and extension points are explicit (e.g., orchestration vs transport).
- Simplicity/compatibility gate: defaults and backward-compatibility impact are documented.
- Verification gate: plan lists project-level build and relevant test validation steps.

Status: PASS (re-check after design artifacts in this plan).

## Project Structure

### Documentation (this feature)

```text
specs/001-initial-src-spec/
├── plan.md
├── research.md
├── data-model.md
├── quickstart.md
├── contracts/
│   ├── dispatcher-contract.md
│   ├── middleware-contracts.md
│   └── configuration-validation-contract.md
├── implementation-implications.md
├── checklists/
│   └── requirements.md
└── tasks.md             # To be generated by /speckit.tasks
```

### Source Code (repository root)
```text
src/
├── Webhooks.Core/
│   ├── Contracts/
│   ├── Extensions/
│   ├── HostedServices/
│   ├── Models/
│   ├── Options/
│   ├── Serialization/
│   ├── Services/
│   ├── SinkProviders/
│   └── Strategies/
└── WebhooksCore.Shared/
    └── Models/

samples/
├── WebhookEvents.Generator.Web/
└── WebhooksEvents.Receiver.Web/
```

**Structure Decision**: Keep the existing single-library architecture and implement changes primarily in `src/Webhooks.Core` contracts/options/services/strategies, with shared model adjustments only when required in `src/WebhooksCore.Shared`.

## Phase 0: Research Output

- Finalize coordinator vs dispatcher boundary to remove single-dispatcher ambiguity.
- Confirm default retry transient-detection heuristics for HTTP dispatcher.
- Confirm restricted JsonPath subset and validation behavior.
- Confirm minimum observability payload for per-sink attempts.

See: `/specs/001-initial-src-spec/research.md`

## Phase 1: Design Output

- Define data model for `Broadcast Event`, `Sink Delivery Attempt`, `Delivery Outcome Record`, and related policy entities.
- Specify contracts for dispatcher invocation, middleware scopes, and configuration validation.
- Document implementation quickstart with build/test validation steps.

See:
- `/specs/001-initial-src-spec/data-model.md`
- `/specs/001-initial-src-spec/contracts/`
- `/specs/001-initial-src-spec/quickstart.md`

## Phase 2: Task Planning Approach

Task generation (`/speckit.tasks`) should be grouped by:

1. Contract and interface changes
2. Options + startup validation
3. Orchestration + pipeline behavior
4. Retry + observability behavior
5. Conformance and regression tests

## Complexity Tracking

> **Fill ONLY if Constitution Check has violations that must be justified**

| Violation | Why Needed | Simpler Alternative Rejected Because |
|-----------|------------|-------------------------------------|
| None | N/A | N/A |
